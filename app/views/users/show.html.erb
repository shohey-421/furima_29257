<% breadcrumb :user %>
<%= render "shared/header" %>

<div class='item-contents'>
  <h2 class='title'><%= @user.nickname%>さんのページ</h2>

  <% if user_signed_in? && current_user.id == @user.id %>

    <%= link_to '登録情報変更', edit_user_registration_path, class: "edit-user" %>

      <h2 class='subtitle'>お気に入りした商品</h2>
      <% if @favorites != [] %>
      <ul class='item-lists'>
        <% @favorites.each do |item| %>
        <li class='list'>
          <%= link_to item_path(item.id) do %>
            <div class='item-img-content'>
              <%= image_tag item.images.first , class: "item-img" %>
            </div>
            <div class='item-info'>
              <h3 class='item-name'>
                <%= item.name %>
              </h3>
              <div class='item-price'>
                <span><%= item.price %>円<br>(税込み)</span>
                <div class='star-btn'>
                  <% if user_signed_in? && Favorite.where(id: item.favorites.ids).find_by(user_id: current_user.id) != nil %>
                    <%= fa_icon "star", class:"favorite-star-icon" %>
                  <% else %>
                    <%= fa_icon "star-o", class:"favorite-star-icon" %>
                  <% end %>
                  <span class='star-count'><%= item.favorites.count %></span>
                </div>
              </div>
            </div>
          <% end %>
        </li>
        <% end %>    
      </ul>
      <% else %>
      お気に入りした商品はありません
      <% end %>

      <h2 class='subtitle'>購入した商品</h2>
      <% if @purchased != [] %>
      <ul class='item-lists'>
        <% @purchased.each do |item| %>
        <li class='list'>
          <%= link_to item_path(item.id) do %>
            <div class='item-img-content'>
              <%= image_tag item.images.first , class: "item-img" %>
            </div>
            <div class='item-info'>
              <h3 class='item-name'>
                <%= item.name %>
              </h3>
              <div class='item-price'>
                <span><%= item.price %>円<br>(税込み)</span>
                <div class='star-btn'>
                  <% if user_signed_in? && Favorite.where(id: item.favorites.ids).find_by(user_id: current_user.id) != nil %>
                    <%= fa_icon "star", class:"favorite-star-icon" %>
                  <% else %>
                    <%= fa_icon "star-o", class:"favorite-star-icon" %>
                  <% end %>
                  <span class='star-count'><%= item.favorites.count %></span>
                </div>
              </div>
            </div>
          <% end %>
        </li>
        <% end %>    
      </ul>
      <% else %>
      購入済の商品はありません
      <% end %>
  <% end %>


  <h2 class='subtitle'>出品した商品</h2>
  <% if @items != [] %>
    <ul class='item-lists'>
      <% @items.each do |item| %>
      <li class='list'>
        <%= link_to item_path(item.id) do %>
        <div class='item-img-content'>
          <%= image_tag item.images.first , class: "item-img" %>

          <% if item.order != nil %> 
          <div class='sold-out'>
            <span>Sold Out!!</span>
          </div>
          <% end %>

        </div>
        <div class='item-info'>
          <h3 class='item-name'>
            <%= item.name %>
          </h3>
          <div class='item-price'>
            <span><%= item.price %>円<br>(税込み)</span>
            <div class='star-btn'>
              <% if user_signed_in? && Favorite.where(id: item.favorites.ids).find_by(user_id: current_user.id) != nil %>
                <%= fa_icon "star", class:"favorite-star-icon" %>
              <% else %>
                <%= fa_icon "star-o", class:"favorite-star-icon" %>
              <% end %>
              <span class='star-count'><%= item.favorites.count %></span>
            </div>
          </div>
        </div>
        <% end %>
      </li>
      <% end %>    
    </ul>
    <% else %>
    出品した商品はありません
    <% end %>
</div>

<%= render "shared/footer" %>